<!DOCTYPE html>
<html>
    <head>
        <title>Clock state</title>
        <script type="module">

import { test, skip } from "../test.js";
import { Clock } from "../../lib/clock.js";
import { ManualTick } from "../../lib/tick.js";

const manualClock = () => Clock.create({ tick: ManualTick.create() });
const pendingUpdate = clock => !!clock.tick.request;

test("Start the clock", t => {
    const clock = Clock.create();
    clock.start();
    t.equal(clock.running, true, "clock is running after start()");
    t.equal(pendingUpdate(clock), true, "pending update after start");
});

test("Start the clock when rate is 0", t => {
    const clock = Clock.create({ rate: 0 });
    clock.start();
    t.equal(clock.running, true, "clock is running after start()");
    t.equal(pendingUpdate(clock), true, "always pending update after state change");
});

test("Stop a running clock", t => {
    const clock = manualClock();
    clock.start();
    clock.stop();
    t.equal(clock.running, false, "clock is stopped after stop()");
    t.equal(pendingUpdate(clock), true, "pending update after state change");
    clock.tick.advance(1);
    t.equal(clock.running, false, "clock is still stopped");
    t.equal(pendingUpdate(clock), false, "no pending update");
});

skip("Resume a stopped clock", t => {
    const clock = manualClock();
    clock.start();
    clock.tick.advance(17);
    clock.stop();
    clock.tick.advance(1);
    t.equal(pendingUpdate(clock), false, "clock is stopped");
    t.equal(clock.now, 18, "clock stopped at 18");
    
    t.equal(clock.running, true, "clock is running after resume()");
    t.equal(pendingUpdate(clock), true, "pending update after resume");
    t.equal(clock.rate, 2, "clock rate is restored after resume()");
});

skip("Resume a paused clock (after update)", t => {
    const clock = Clock.create({
        tick: ManualTick.create(),
        rate: 2
    });
    clock.start();
    clock.pause();
    clock.tick.advance(1);
    clock.resume();
    t.equal(clock.state, Clock.States.Running, "clock is running after resume()");
    t.equal(pendingUpdate(clock), true, "pending update after resume");
    t.equal(clock.rate, 2, "clock rate is restored after resume()");
});

skip("Advance a paused clock", t => {
    const clock = Clock.create({
        tick: ManualTick.create()
    });
    clock.start();
    clock.pause();
    clock.tick.advance(1);
    t.equal(clock.state, Clock.States.Paused, "clock is paused");
    t.equal(pendingUpdate(clock), false, "no pending update after pause()");
    clock.advance(17);
    clock.tick.advance(1);
    t.equal(clock.state, Clock.States.Paused, "clock is paused");
    t.equal(pendingUpdate(clock), false, "no pending update");
    t.equal(clock.now, 17, "clock rate is zero when paused");
});

skip("Advance a running clock", t => {
    const clock = Clock.create({
        tick: ManualTick.create()
    });
    clock.start();
    clock.tick.advance(1);
    t.equal(clock.state, Clock.States.Running, "clock is paused");
    t.equal(clock.now, 1, "time moving at normal rate");
    clock.advance(17);
    clock.tick.advance(1);
    t.equal(clock.now, 19, "time advanced artificially and naturally");
});

skip("Skip time when paused", t => {
    const clock = Clock.create({
        tick: ManualTick.create()
    });
    clock.start();
    clock.pause();
    clock.tick.advance(1);
    t.equal(clock.state, Clock.States.Paused, "clock is paused");
    t.equal(pendingUpdate(clock), false, "no pending update after pause()");
    clock.skip(17);
    t.equal(clock.state, Clock.States.Paused, "clock is paused");
    t.equal(pendingUpdate(clock), false, "no pending update");
    t.equal(clock.now, 17, "clock rate is zero when paused");
});

skip("Skip time when running", t => {
    const clock = Clock.create({
        tick: ManualTick.create()
    });
    clock.start();
    clock.tick.advance(1);
    t.equal(clock.state, Clock.States.Running, "clock is paused");
    t.equal(clock.now, 1, "time moving at normal rate");
    clock.skip(17);
    clock.tick.advance(1);
    t.equal(clock.now, 19, "time advanced artificially and naturally");
});

        </script>
    </head>
    <body>
    </body>
</html>
